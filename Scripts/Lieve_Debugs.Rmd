---
title: "Lieve_Debugs"
author: "Lieve Verschelde & Marijke Thoonen"
date: "2025-03-17"
output: html_document
---

## Load required packages
### With the library googlesheets4, Rstudio has access to the dataset
```{r packages, include=FALSE}
library(lubridate)
library(dplyr)
library(tidyverse)

# to load google sheet
library(googlesheets4) 

# to name columns
library(janitor)  
```

## Set working directory
Sets the working directory in R to the folder containing the currently active script
```{r working directory}
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
```

## Load raw data
```{r}
sheet_url <- "https://docs.google.com/spreadsheets/d/1uJ7rvQBkw0_-e2dsiBlX2NJcrCcfEFqC-ZvEV0RwNVg/edit"
groundbeetle.data <- read_sheet(sheet_url, col_names = FALSE)

```

## Edit and finetune raw dataset
```{r}
# remove first row
groundbeetle.data <- groundbeetle.data %>% slice(-1) 
# make first row header
groundbeetle.data <- groundbeetle.data %>% row_to_names(row_number = 1)

# convert column dates to date type
groundbeetle.data$Ophaaldatum <- ymd(groundbeetle.data$Ophaaldatum) 
  # 1 date failed, sample without label

# convert data to a data set, easier to make models
groundbeetle.data <- as.data.frame(groundbeetle.data) 

# View dataset
View(groundbeetle.data)
```

## Convert datatypes 
```{r}
# convert column of sample numbers to character
groundbeetle.data$Staalnummer <- as.character(groundbeetle.data$Staalnummer)


# View datatypes of dataset
glimpse(groundbeetle.data)

# Identify remainder columns with 'list' type (all species)
list_columns <- sapply(groundbeetle.data, is.list)

# Conversion
groundbeetle.data[, list_columns] <- lapply(groundbeetle.data[, list_columns], function(column) {
  # Convert NULL to NA
  column <- sapply(column, function(x) if (is.null(x)) NA else x)
  # Apply conversion to numeric
  column <- as.numeric(unlist(column))
})

# select species columns
species_columns <- names(groundbeetle.data)[sapply(groundbeetle.data, is.numeric)]

# replace all NA with 0 in species columns
groundbeetle.data <- groundbeetle.data %>%
  mutate(across(all_of(species_columns), ~ ifelse(is.na(.), 0, .)))


## View datatype after conversion
sapply(groundbeetle.data, class)
View(groundbeetle.data)
```

# Link traitlist with groundbeetle dataset
```{r}

```

